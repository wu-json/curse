version: 2
builds:
  - id: "curse"
    builder: bun
    binary: curse
    targets:
      - linux-x64-modern
      - linux-arm64
      - darwin-arm64
      - darwin-x64
    main: "src/index.ts"
    tool: bun
    command: build
    flags:
      - --compile
      - --minify
checksum:
  algorithm: sha256
  split: true
  name_template: "{{ .ProjectName }}_{{ .Version }}_{{ .Os }}_{{ .Arch }}.sha256"
snapshot:
  version_template: "{{ .Version }}"
homebrew_casks:
  - repository:
      owner: wu-json
      name: homebrew-curse
    homepage: "https://github.com/wu-json/curse"
    description: "Incantations in your terminal. "

    # Handle macOS quarantine for unsigned binaries:
    # https://goreleaser.com/customization/homebrew_casks/#signing-and-notarizing
    hooks:
      post:
        install: |
          if OS.mac?
            system_command "/usr/bin/xattr", args: ["-dr", "com.apple.quarantine", "#{staged_path}/curse"]
          end
